var bus = require('../systemBus');
var board = require('board');
var observer = require('observer');

function translate(cellString) {
    var map = {
        'A': '1',
        'B': '2',
        'C': '3',
        'D': '4',
        'E': '5',
        'F': '6',
        'G': '7',
        'H': '8'
    };

    cellString = cellString.replace(/^[A-H]/, function(char) { return map[char] });
    return cellString;
}

function gameEngine() {
    var that = this;
    this.board = new board();
    this.observer = new observer();

    bus.on('move', function(data) {
        //console.log(data);
        //var squareFromWhichToMove =
        //    that.board.getGridSquare(translate(data[0])[0], data[0][1]);

        //console.log(squareFromWhichToMove);
        //console.log(squareFromWhichToMove.getRank());

        //var returnVal =
        //    that.observer.move(squareFromWhichToMove,
        //                       translate(data[1])[0], data[1][1]);

        //console.log(returnVal);
        bus.emit('moved', data);
    });
    bus.on('clear', function() {
        // Destroy the game
    });

    return this.board.getPiecemap();
}

module.exports = gameEngine;