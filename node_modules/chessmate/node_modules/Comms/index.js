var parseCommand = require('commands');

// Matches any command
var commandRegex = /\/.*/;

function server(bus) {
    this.bus = bus;
}

// Returns an object containing a message to be displayed to the client and
// [optionally] a command to be executed on the client.
server.prototype.receive = function(message) {
    var components = message.split(' ');
    if (commandRegex.test(components[0])) {
        var instruction = parseCommand(components[0], components, this.bus);
        return instruction;
    }
    else
        return { message: components.join(' '),
                 command: false,
                 broadcast: true };
};

server.prototype.test = function(message) {
    if (message === '')
        return;
    var components = message.split(' ');
    return commandRegex.test(components[0]);
};

module.exports = server;