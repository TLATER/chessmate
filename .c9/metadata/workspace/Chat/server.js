{"changed":false,"filter":false,"title":"server.js","tooltip":"/Chat/server.js","undoManager":{"mark":0,"position":0,"stack":[[{"group":"doc","deltas":[{"start":{"row":0,"column":0},"end":{"row":39,"column":3},"action":"insert","lines":["var mongo = require('mongodb').MongoClient;","var client = require('socket.io').listen(2000).sockets;","","mongo.connect('mongodb://127.0.0.1/chat', function(err, db){","\tif(err)","\t\tthrow err;","\tclient.on('connection', function(socket){","\t\t","\t\tvar database = db.collection('messages');","\t\tvar sendStatus = function(s){","\t\t\tsocket.emit('status',s);","\t\t};","","\t\tdatabase.find().toArray(function(err, response){","\t\t\tif(err)","\t\t\t\tthrow err;","\t\t\telse","\t\t\t\tsocket.emit('output', response);","\t\t});","","\t\tsocket.on('input', function(data){","\t\t\tvar name = data.name;","\t\t\tvar message = data.message;","\t\t\tvar whiteSpacePattern = /^\\s*$/;","\t\t\tif(whiteSpacePattern.test(name) || whiteSpacePattern.test(message)){","\t\t\t\tsendStatus(\"Name and message required\");","\t\t\t}","\t\t\telse{","\t\t\t\tdatabase.insert({name : name, message : message}, function(){","","\t\t\t\tclient.emit('output', [data]);","\t\t\t\tsendStatus({","\t\t\t\t\tmessage : \"Message was sent\",","\t\t\t\t\tclear : true","\t\t\t\t});","\t\t\t});","\t\t}","\t});","});","});"]}]}]]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":8,"column":38},"end":{"row":8,"column":38},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1424088282000}